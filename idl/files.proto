syntax = "proto3";
option go_package = "files/";

message FileModel {
  // @inject_tag: json:"file_id"
  uint64 FileID = 1;
  // @inject_tag: json:"user_id"
  uint64 UserID = 2;
  // @inject_tag: json:"file_name"
  string FileName = 3;
  // @inject_tag: json:"file_size"
  int64 FileSize = 4;
  // @inject_tag: json:"bucket"
  string Bucket = 5;        // 存储桶名称（如 MinIO 的 bucket）
  // @inject_tag: json:"object_name"
  string ObjectName = 6;    // 存储对象名（唯一标识）
}

// 文件上传（表单上传）
message FileUploadRequest {
  // @inject_tag: json:"user_id" form:"user_id"
  uint64 UserID = 1;
  // @inject_tag: json:"file_name" form:"file_name"
  string Filename = 2;
  // @inject_tag: json:"file_size"
  int64 FileSize = 3;
  // @inject_tag: json:"object_name"
  string ObjectName = 4;
  // @inject_tag: json:"file_hash"
  string FileHash = 5;
}

message FileUploadResponse {
  // @inject_tag: json:"code" form:"code"
  int64 Code = 1;
  // @inject_tag: json:"msg" form:"msg"
  string Msg = 2;
  // @inject_tag: json:"object_url"
  string ObjectUrl = 3;
  // @inject_tag: json:"file_id" form:"file_id"
  uint64 FileID = 4;
}

// 文件上传（二进制上传）
message BigFileUploadRequest {
  // @inject_tag: json:"user_id" form:"user_id"
  uint64 UserID = 1;
  // @inject_tag: json:"file_name" form:"file_name"
  string Filename = 2;          // 文件名，仅首个分片携带
  // @inject_tag: json:"file_size"
  int64 FileSize = 3;
  // @inject_tag: json:"object_name"
  string ObjectName = 4;
  // @inject_tag: json:"content" form:"content"
  bytes Content = 5;            // 当前分片的数据
  // @inject_tag: json:"is_last" form:"is_last"
  bool IsLast = 6;            // 是否为最后一个分片
  // @inject_tag: json:"file_hash"
  string FileHash = 7;
}

message BigFileUploadResponse {
  // @inject_tag: json:"code" form:"code"
  int64 Code = 1;
  // @inject_tag: json:"msg" form:"msg"
  string Msg = 2;
  // @inject_tag: json:"object_url"
  string ObjectUrl = 3;
  // @inject_tag: json:"file_id" form:"file_id"
  uint64 FileID = 4;
}

// 文件删除
message FileDeleteRequest {
  // @inject_tag: json:"file_id" form:"file_id"
  uint64 FileID = 1;
  // @inject_tag: json:"user_id" form:"user_id"
  uint64 UserID = 2;
}

// 文件列表请求与响应
message FileListRequest {
  // @inject_tag: json:"user_id" form:"user_id"
  uint64 UserID = 1;
  // @inject_tag: json:"page" form:"page"
  int32 Page = 2;
  // @inject_tag: json:"page_size" form:"page_size"
  int32 PageSize = 3;
}

message FileListResponse {
  // @inject_tag: json:"code"
  int32 Code = 1;
  // @inject_tag: json:"msg"
  string Msg = 2;
  // @inject_tag: json:"files"
  repeated FileModel Files = 3;
  // @inject_tag: json:"total"
  int64 Total = 4;
}

// 下载请求与响应（返回预签名URL或本地路径）
message FileDownloadRequest {
  // @inject_tag: json:"file_id" form:"file_id"
  uint64 FileID = 1;
  // @inject_tag: json:"file_name" form:"file_name"
  string Filename = 2;
  // @inject_tag: json:"user_id" form:"user_id"
  uint64 UserID = 3;
}

message FileDownloadResponse {
  // @inject_tag: json:"code"
  int32 Code = 1;
  // @inject_tag: json:"msg"
  string Msg = 2;
  // @inject_tag: json:"download_url"
  string DownloadUrl = 3;
  // @inject_tag: json:"file_name" form:"file_name"
  string Filename = 4;
}

message FileCommonResponse {
  // @inject_tag: json:"code" form:"code"
  int64 Code = 1;
  // @inject_tag: json:"msg" form:"msg"
  string Msg = 2;
}

// 秒传哈希检测
message CheckFileRequest {
  // @inject_tag: json:"file_hash"
  string FileHash = 1;
  // @inject_tag: json:"user_id" form:"user_id"
  uint64 UserID = 2;
}

message CheckFileResponse {
  // @inject_tag: json:"file_id" form:"file_id"
  uint64 FileID = 1;
  // @inject_tag: json:"object_url"
  string ObjectUrl = 2;
  // @inject_tag: json:"exists"
  bool exists = 3;
}

// 全局 file_name 模糊搜索
message GlobalFileSearchRequest {
  // @inject_tag: json:"file_name" form:"file_name"
  string FileName = 1;     // 文件名关键词（支持模糊搜索）
  // @inject_tag: json:"page" form:"page"
  uint32 Page = 2;         // 页码，从1开始
  // @inject_tag: json:"page_size" form:"page_size"
  uint32 PageSize = 3;     // 每页大小，默认10
  // @inject_tag: json:"bucket" form:"bucket"
  string Bucket = 4;       // 存储桶过滤（可选），如"qiniu"
}

message GlobalFileSearchResponse {
  // @inject_tag: json:"code" form:"code"
  int64 Code = 1;
  // @inject_tag: json:"msg" form:"msg"
  string Msg = 2;
  // @inject_tag: json:"global_file_info"
  repeated GlobalFileInfo Files = 3;
  // @inject_tag: json:"total"
  uint32 Total = 4;        // 总记录数
  // @inject_tag: json:"page"
  uint32 Page = 5;         // 当前页码
  // @inject_tag: json:"page_size"
  uint32 PageSize = 6;     // 每页大小
}

message GlobalFileInfo {
  // @inject_tag: json:"file_id"
  uint64 FileID = 1;       // 文件ID
  // @inject_tag: json:"file_name"
  string FileName = 2;     // 文件名
  // @inject_tag: json:"file_size"
  int64 FileSize = 3;      // 文件大小
  // @inject_tag: json:"bucket"
  string Bucket = 4;       // 存储桶
  // @inject_tag: json:"object_name"
  string ObjectName = 5;   // 对象名
  // @inject_tag: json:"file_hash"
  string FileHash = 6;     // 文件哈希
  // @inject_tag: json:"user_id"
  uint64 UserID = 7;       // 上传用户ID
  // @inject_tag: json:"created_at"
  string CreatedAt = 8;    // 创建时间
  // @inject_tag: json:"updated_at"
  string UpdatedAt = 9;    // 更新时间
}

service FilesService {
  rpc FileUpload(FileUploadRequest) returns (FileUploadResponse);
  rpc BigFileUpload(stream BigFileUploadRequest) returns(BigFileUploadResponse);
  rpc FileDelete(FileDeleteRequest) returns (FileCommonResponse);
  rpc FileList(FileListRequest) returns (FileListResponse);
  rpc FileDownload(FileDownloadRequest) returns (FileDownloadResponse);
  rpc CheckFileExists(CheckFileRequest) returns (CheckFileResponse);
  // 七牛云上传接口
  rpc QiniuFileUpload(FileUploadRequest) returns (FileUploadResponse);
  rpc QiniuBigFileUpload(stream BigFileUploadRequest) returns(BigFileUploadResponse);
  // 七牛云下载接口
  rpc QiniuFileDownload(FileDownloadRequest) returns (FileDownloadResponse);
  // 全盘文件搜索接口
  rpc GlobalFileSearch(GlobalFileSearchRequest) returns (GlobalFileSearchResponse);
  // 七牛云文件删除接口
  rpc QiniuFileDelete(FileDeleteRequest) returns (FileCommonResponse);
}